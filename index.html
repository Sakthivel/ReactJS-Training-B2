<!DOCTYPE html>
<html lang="en">
<head>
<title>::ReactJS Assignment::</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<style>
    body {
        font-size: 12px;
        font-family: Verdana, Geneva, Tahoma, sans-serif;
        font-weight: normal;
    }
    .title {
        text-align: center;
        padding: 20px 0;
    }
    .container {
        background: #f9f9f9;
        padding: 20px 0;
     }
    .form-outer, .issue-form-outer {
        margin: 50px auto;
        width: 50%;
    }
    .result, .issue-list {
        margin: 50px auto;
        width: 75%;
    }
    .error-msg {
        text-align: center;
    }
    .list {
        padding: 10px 0;
    }
    .hidden {
        display: none;
    }
    footer {
        margin-top: 100px;
    }
    .footer-title {
        text-align: center;
    }
    .repo-name {
       padding: 10px 20px 20px;
       border-bottom: 1px solid #cccccc;
    }
    .issue-description {
        padding: 5px 15px 10px;
    }
    .backBtn {
        padding-top: 10px;
    }
    .repo-name span, .details span, .reposname {
        font-size: 14px;
        color: black;
        font-weight: bold;
    }
    .reponame {
        padding: 15px 0;
        text-align: center;
        font-size: 16px;
    }
    form label {
        padding: 10px 0;
        font-size: 14px;
    }
</style>
</head>
<body>
<div class="container">
    <header><h2 class="title">Login Page</h2></header>
    <div class="error-msg hidden">Server Error</div>
    <div class="container">
        <form>
            <div class="form-outer">
                
                    <div class="form-group" id="userlogin">
                        <label>Username</label>
                        <input type="text" id="username" class="form-control" placeholder="Github Username">
                    </div>
                    <button type="submit" class="btn btn-primary login">Get Repository</button>
                
            </div>
            <div class="result hidden"></div>
            <div class="issue-list hidden"></div>
            <div class="issue-form-outer hidden">
            
                    <div class="form-group" id="issue">
                        <label>Issue Title</label>
                        <input type="text" id="issueTitle" class="form-control" placeholder="Title">
                        <label>Issue Description</label>
                        <input type="text" id="issueDescription" class="form-control" placeholder="Description">
                        <input type="hidden" id="user" value="">
                        <input type="hidden" id="repos" value="">
                    </div>
                    <button type="submit" class="btn btn-primary add-issue-form">Creat an Issue</button>&nbsp;<button type="button" class="btn btn-primary back-result">Back</button>
            
            </div>
        </form>
            
    </div>

    <footer>
        <hr/>
        <div class="footer-title">ReactJS Assignment</div>
    </footer>
</div>
<script>
    
    $(".btn-primary.login").click(function(event) {
        var username = $('#username').val();
        if (username) {
            formSubmit(username);
        }
        event.preventDefault();
    });

    $(".btn-primary.add-issue-form").on('click', addIssueForm);
    $(".back-result").on('click', backtoResult);

    function addIssue(event) {
        var $el = $(event.currentTarget);
        hideRepos();
        issueFormShow();
        
        $('#user').val($el.data('name'));
        $('#repos').val($el.data('repo'));
    }

    function viewIssue(event) {
        var $el = $(event.currentTarget);
        hideRepos();
        issueListShow();
        issueView($el.data('name'), $el.data('repo'));
    }

    function addIssueForm() {
        hideRepos();
        $('h2.title').text('Add issue form');
        var title = $('#issueTitle').val();
        var description = $('#issueDescription').val();
        var user = $('#user').val();
        var repo = $('#repos').val();
        if (title && description) {
            issueSubmit(title, description, user, repo);
        }
        event.preventDefault();
    }

    function backtoResult(){
        showRepos();
        issueListHidden();
    }

    function issueView(user, repo) {
        $.ajax({
            type: 'GET',
            url: 'https://api.github.com/repos/' + user + '/' + repo + '/issues',
            beforeSend: function(xhr) {
                xhr.setRequestHeader("Authorization", "token 6505d64eff8570079661889573b737eb1bb676da");
            }
        }).done(function(data){
            loadIssues(data, repo);
        }).fail(function(){
            showError();
        });
    }

    function issueSubmit(title, description, user, repo) {
        $.ajax({
            type: 'POST',
            url: 'https://api.github.com/repos/' + user + '/' + repo + '/issues',
            data: JSON.stringify({ "title": title, "body": description }),
            beforeSend: function(xhr) {
                xhr.setRequestHeader("Authorization", "token 6505d64eff8570079661889573b737eb1bb676da");
            }
        }).done(function(data){
            showRepos();
            issueFormHidden();
        }).fail(function(){
            showError();
        });
    }

    function formSubmit(username) {
        $.ajax({
            type: 'GET',
            url: 'https://api.github.com/users/' + username + '/repos',
            beforeSend: function(xhr) {
                xhr.setRequestHeader("Authorization", "token 6505d64eff8570079661889573b737eb1bb676da");
            }
        }).done(function(data){
            loadRepo(data, username);
                
        }).fail(function(){
            showError();
        });
    }

    function loadRepo(data, username) {
        var resultHtml = '<div class="details">';
                showRepos();
                $('.form-outer').addClass('hidden');
                $.each(data, function(key,val) {
                   resultHtml += '<div class="repo-name"><p class="reposname">' + data[key].name + '</p><button type="button" data-name="'+ username +'" data-repo="' + data[key].name + '" class="btn btn-outline-danger btn-sm add-issue">Add Issue</button>&nbsp;<button type="button" data-name="'+ username +'" data-repo="' + data[key].name + '" class="btn btn-outline-danger btn-sm view-issue">View Issue</button></div>';
                });
                resultHtml += '</div>';

                $('.result').html(resultHtml);
                $(".add-issue").on('click', addIssue);
                $(".view-issue").on('click', viewIssue);

    }

    function loadIssues(data, repo) {
        issueListShow();
        var resultHtml = '<div class="details"><p class="reponame"><span>' + repo + '</span></p>';
                $.each(data, function(key,val) {
                   resultHtml += '<div class="repo-name"><p><span>Issue Title:</span> ' + data[key].title + '</p><div class="issue-description"><span>Issue Description:</span> ' +  data[key].body + '</div></div>';
                });
                resultHtml += '<div class="backBtn"><button type="button" class="btn btn-primary back-result">Back</button></div></div>';

                $('.issue-list').html(resultHtml);
                $(".back-result").on('click', backtoResult);
                $('h2.title').text('List of Issues');
    }

    function showError() {
        $('.error-msg').removeClass('hidden');
    }

    function showRepos() {
        $('.result').removeClass('hidden');
        $('h2.title').text('List of Repositories');
        hideform();
        issueListHidden();
        issueFormHidden();
    }

    function hideRepos() {
        $('.result').addClass('hidden');
    }

    function issueFormHidden() {
        $('.issue-form-outer').addClass('hidden');
    }

    function issueFormShow() {
        $('.issue-form-outer').removeClass('hidden');
        issueListHidden();
        hideform();
        hideRepos();
    }

    function issueListHidden() {
        $('.issue-list').addClass('hidden');
    }

    function issueListShow() {
        $('.issue-list').removeClass('hidden');
        hideform();
        hideRepos();
        issueFormHidden();
    }

    function hideform() {
        $('.form-outer').addClass('hidden');
    }
    
</script>
</body>
</html>
